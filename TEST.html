

<!DOCTYPE HTML >
<html>

<script src="https://api.gazerecorder.com/GazeCloudAPI.js" ></script>
      <!-- script在css排版里隐藏 -->
      
      <style type="text/css"> 
         body {
         overflow: hidden;
         }
      </style>

      <script type = "text/javascript" >
         // GazeCloudAPI.StartEyeTracking();

         //设置取眼动数据的频率，一秒多少帧？
         var gazeFrequency = 1
         var timeCount = false

         var calibrationEnd = false;
         var gazeTrackingEnd = false;

         
         function PlotGaze(GazeData) {
         // 在页面上显示结果；
         document.getElementById("GazeData").innerHTML = "GazeX: " + GazeData.GazeX + " GazeY: " + GazeData.GazeY;
         document.getElementById("HeadPhoseData").innerHTML = " HeadX: " + GazeData.HeadX + " HeadY: " + GazeData.HeadY + " HeadZ: " + GazeData.HeadZ;
         document.getElementById("HeadRotData").innerHTML = " Yaw: " + GazeData.HeadYaw + " Pitch: " + GazeData.HeadPitch + " Roll: " + GazeData.HeadRoll;

         // 显示gaze point
         // 不需要的话直接注释掉
         var x = GazeData.docX;
         var y = GazeData.docY;
         var gaze = document.getElementById("gaze");
         x -= gaze .clientWidth/2;
         y -= gaze .clientHeight/2;
         gaze.style.left = x + "px";
         gaze.style.top = y + "px";
         if(GazeData.state != 0)
         {
            if( gaze.style.display  == 'block')
            gaze  .style.display = 'none';
         }
         else
         {
            if( gaze.style.display  == 'none')
            gaze  .style.display = 'block';
         }   


         
         //存储眼动结果到LocalStorage
         if (calibrationEnd && gazeTrackingEnd == false )
         {
            //数据存储格式，[TimeStamp], [GazeX, GazeY, HeadX, HeadY, HeadZ, Yaw, Pitch, Roll]
            localStorage.setItem(GazeData.time, GazeData.GazeX.toString()+','+GazeData.GazeY.toString()+','+GazeData.HeadX.toString()+','+GazeData.HeadY.toString()+','+GazeData.HeadZ.toString()+','+GazeData.HeadYaw.toString()+','+GazeData.HeadPitch.toString()+','+GazeData.HeadRoll.toString());
            timeCount = false;
         }

         }

         function StopTracking()
         {
            gazeTrackingEnd = true;
            
            //从localstorage里拿到所有眼动数据并存到Blob类文件对象中，存到txt文件里并下载
            let data = JSON.stringify(localStorage,null, 4);
            let blob = new Blob([data], {type: "text/plain;charset=utf-8"});  
            let url = URL.createObjectURL(blob);  
            let gazeFile = document.createElement('a');  
            gazeFile.href = url;  
            var currentTime = new Date();
            gazeFile.download = currentTime.toString(); // 用当前时间来命名文件，也可根据需要来自定义存储文件的命名格式  
            gazeFile.click();

            localStorage.clear();

         }
         
         //////set callbacks/////////
         window.addEventListener("load", function() 
         {
            GazeCloudAPI.OnCalibrationComplete =function()
            {
               console.log('gaze Calibration Complete');
               calibrationEnd=true;
            }
            GazeCloudAPI.OnCamDenied =  function(){ console.log('camera  access denied')  }
            GazeCloudAPI.OnError =  function(msg){ console.log('err: ' + msg)  }
            GazeCloudAPI.UseClickRecalibration = true;
            GazeCloudAPI.OnResult = PlotGaze; 
         });
     
      </script>

   <head>
      <title>GazeCloudAPI</title>
   </head>
   <body >
      <h1>GazeCloudAPI integration example</h1>
      <!-- 用按钮来控制eye tracking的开始和结束，也可以根据需求改成其他的方式
      眼动开始控制用GazeCloudAPI.StartEyeTracking()
      眼动结束用GazeCloudAPI.StopEyeTracking() -->
      <button  type="button" onclick="GazeCloudAPI.StartEyeTracking();">Start</button>
      <button  type="button" onclick="GazeCloudAPI.StopEyeTracking();StopTracking();">Stop</button>

      <!-- 这部分不能删！很重要！不会影响排版，放着即可 -->
     <div >
         <p >  
         <p id = "GazeData" > </p>
         <p id = "HeadPhoseData" > </p>
         <p id = "HeadRotData" > </p>
         </p>
      </div>
      <div id ="gaze" style ='position: absolute;display:none;width: 100px;height: 100px;border-radius: 50%;border: solid 2px  rgba(255, 255,255, .2);   box-shadow: 0 0 100px 3px rgba(125, 125,125, .5);  pointer-events: none;   z-index: 999999'></div>
      ;  
   </body>

</html>
